\documentclass[../kategoricna_logika.tex]{subfiles}
\begin{document}
\section{Regularna logika}
Do sedaj smo videli povezavo med algebrajsko teorijo in kategorijo z neko dodatno struktuo, ki nam je omogočila interpretacijo take teorije v semantiki same kategorije. Teorija, ki smo jo obravnavali je bila precej enostavna s stališča logike, saj so bile edine logične formule, ki smo jih lahko konstruirali oblike $t_1 = t_2$ za neka terma, sestavljena induktivno iz spremenljivk in funkcijskih simbolov. 
Že iz teh osnovnih gradnikov je mogoče dobiti veliko pomembne matematične ``infrastrukture'', kot je na primer teorija grup. Za opis nekih matematičnih teorij pa jasno ta stopnja kompleksnosti ne zadostuje.
Videli smo, da se teorije polj ne da opisati z algebrajsko teorijo. Moderna matematika je standardno opisana v jeziku predukatne logike, oz logike drugega (ali višjega) reda, kjer imamo poleg funkcijskih simbolov še logične veznike kot so ``in'', ``ali'', negacijo in univerzalni ter eksistenčni kvantifikator.
Naravno vprašanje je torej, ali lahko zgodbo algebrajskih teorij ponovimo z neko močnejšo logiko in če se to da, kako se to odraža v strukturi kategorijo, ki jo dobimo na ta način in ali ohranimo lepe lastnosti, ki smo jih videli v primeru algebrajskih teorij.
Kot vemo iz Gödelovega izreka o polnosti logike prvega reda, za modele v kategoriji množic to velja. Zanima nas, ali je to definicijo modela mogoče razširiti na podoben način kot za algebrajske teorije.
Naredili bomo korak v to smer in našo logiko le delno razširili v tako imenovano $\emph{regularno logiko}$, kjer bomo formule gradili iz atomskih formul, logične konstante resničnosti $\top$, konjunkcij $\wedge$ in eksistenčnega kvantifikatorja $\exists$.
Videli bomo, da s to razširitvijo lahko ponovimo zgodbo iz prvega dela in nam to da tako imenovane \emph{regularne kategorije}, ki bodo imele dodatno strukturo, ki nam bo omogočala interpretacijo te logike.
Da to logiko definiramo, moramo najprej razširiti pojem jezika.
%
\begin{definicija}
  \emph{Signatura} regularnega jezika $\Sigma$ je sestavljena iz množice \emph{osnovnih tipov} $\underline{\mathrm{sort}}_\Sigma = \set{X_1, X_2, X_3, \ldots}$, množice konstant $\underline{\mathrm{const}}_\Sigma$, množice funkcijskih simbolov $\underline{\mathrm{func}}_\Sigma$ in množice relacijskih simbolov $\underline{\mathrm{rel}}_\Sigma$. Uporabljamo oznake kot so $c : X$ za konstante tipa $X$, $f : X_1 \times \ldots \times X_n \to Y$ za funkcijske simbole in $R \rightarrowtail X_1 \times \ldots \times X_n$ za relacijske simbole.
\end{definicija}
Pogosto bomo za $X_1 \times \ldots X_n$ uporabljali tudi oznako $\overline{X}$, kjer $n$ razberemo iz konteksta.
\begin{definicija}
  Naj bo $\Sigma$ signatura regularnega jezika. Potem \emph{(regularen?) jezik} $\mathcal{L}(\Sigma)$ sestoji iz signature $\Sigma$, za vsak osnovni tip $X$ imamo števno mnogo spremenljivk $x:X$. Množice termov $(T)$ in formul $(F)$ definiramo na sledeče načine:
  \begin{itemize}
    \item [(T1)] Če je $x$ spremenljivka tipa $X$, potem je $x$ term tipa $X$.
    \item [(T2)] Če je $c$ konstanta tipa $X$, potem je $c$ term tipa $X$.
    \item [(T3)] Če so $t_1, \ldots t_n$ že termi tipov $X_1, \ldots, X_n$ in je $f : X_1 \times \ldots \times X_n \to Y$ funkcijski simbol, potem je $f(t_1, \ldots, t_n)$ term tipa $Y$.
    \item [(F1)] Če sta $t_1, t_2$ terma tipov $X_1$ in $X_2$, potem je $t_1 = t_2$ formula. Bolj natančno bi to zapisali kot $t_1 =_X t_2$.
    \item [(F2)] Logična konstanta $\top$ (ki predstavlja resninično izjavo) je formula.
    \item [(F3)] Če so $t_1, \ldots t_n$ termi tipov $X_1, \ldots, X_n$ in je $R \rightarrowtail X_1 \times \ldots \times X_n$ relacijski simbol, potem je $R(t_1, \ldots, t_n)$ formula.
    \item [(F4)] Če sta $\varphi$ in $\psi$ logični formuli, potem sta $\varphi \wedge \psi$ in $\exists x \varphi$ tudi logični formuli.
  \end{itemize}
  Za logično formulo $\varphi$, množico njenih prostih spremenljiv označujemo z $\mathrm{FV}(\varphi)$. \emph{Teorija} $T$, formulirana v jeziku $\mathcal{L}(\Sigma)$, je množica \emph{sekvent} oblike 
  $$\varphi \implies \psi$$
  kjer sta $\varphi$ in $\psi$ formuli v jeziku teorije $T$.
\end{definicija}
Če je v sekventi premisa enaka $\top$ potem $\top \implies \psi$ označujemo kar kot $\psi$.
\begin{primer}\label{primer:kompozitum}
  Naj bo $\Sigma$ signatura s termi osnovnimi tipi $X,Y$ in $Z$, ki vsebuje tri funkcijske simbole $f: X \to Y$, $g : Y \to Z$ in $h : X \to Z$. V jeziku $\mathcal{L}(\Sigma)$ potem, če je $x$ spremenljivka tipa $X$, lahko v jeziku $\mathcal{L}(\Sigma)$ tvorimo formulo
  $$f(g(x)) = h(x)$$
  Ko definiramo interpretacijo teorije bomo videli, da je to ravno formula, ki pomeni, da je $h$ kompozitum $f$ in $g$.
\end{primer}
\begin{primer}[Delno urejene grupe]
  Naj bo $\Sigma$ signatura z enim osnovnim tipom $X$. Za delno urejeno grupo potrebujemo operacije grupe:
  \begin{itemize}
    \item konstanto $e : X$, ki predstavlja enoto grupe,
    \item operacijo množenja $m : X \times X \to X$,
    \item operacijo inverza $i : X \to X,$
  \end{itemize}
  ki zadoščajo aksiomom
  \begin{itemize}
    \item[(G1)] $m(x,(m(y,z))) = m(m(x,y), z)$
    \item[(G2)] $m(x,e) = m(e,x) = x$
    \item[(G3)] $m(x,i(x)) = m(i(x), x) = e$
  \end{itemize}
  Poleg tega imamo še relacijo $\leq$, za katero veljajo aksiomi delne urejenosti:
  \begin{itemize}
    \item[(U1)] $x \leq x$ (refleksivnost)
    \item[(U2)] $x \leq y \wedge y \leq x \implies x = y$ (anti-simetričnost)
    \item[(U3)] $x \leq y \wedge y \leq z \implies x \leq z$ (tranzitivnost)
  \end{itemize}
  Za definicje delno urejene grupe potrebujemo še aksiom \emph{invariance za translacijo}, ki pravi
  \begin{itemize}
    \item[(TI)] $x \leq y \implies m(x, g) \leq m(y, g) \wedge m(g,x) \leq m(g,y)$
  \end{itemize}
\end{primer}

Sedaj bomo definirali pravila sklepanja za naš fragment logike prvega reda, 
za katera bomo kasenje pokazali, da so veljavna in polna glede na kategorično semantiko, ki jim jih bomo dali.
Podali jih bomo kot zaporedja dedukcij oblike $\varphi \vdash_F \psi$, indeksiranih po končnih množicah spremenljivk $F$. Dedukcija $\varphi \vdash \psi$ je definirana le, če vse proste spremenljivke v $\varphi$ ali $\psi$ ležijo v $F$. V prihodnje bomo privzeli, da je za izraz $\varphi \vdash \psi$ ta pogoj vedno izpolnjen (napiši to lepše).
Tu moramo biti pozorni, saj na primer izraz $x_1 = x_2 \vdash_{x_1, x_2} x_2 = x_1$ ni enak izrazu $x_1 = x_2 \vdash_{x_1, x_2, x_3} x_2 = x_1$. Razlog za to podrobnost bomo razložili kasneje, ko definiramo semantiko v kategoriji.

Sedaj definiramo pravila sklepanja v regularni logiki, ki jih razdelimo v tri sklope:
(ali je lepo dati dvopičje direkt pred def okoljem)
Podali jih bomo kot izpeljave, ki so zapisane v obliki ulomka, kjer števec predstavlja premise,
imenovalec pa skelp izpeljave.
Beremo jih kot: če veljajo vse premise nekega pravila, lahko izpeljemo njegov sklep.
Če neka izpeljava velja v obe smeri, torej če lahko iz premis $A$ izpeljemo sklep $B$ in iz premise $B$ izpeljemo sklep~$A$,
potem to podamo kot dvosmerno izpeljavo, ki jo označimo z dvojno črto ulomka.

\begin{definicija}
  $ $
  \begin{enumerate}[label*=\arabic*.]
    \item Strukturna pravila
    \begin{enumerate}[label*=\arabic*]
      \item 
        \begin{prooftree}
          \AxiomC{}
          \UnaryInfC{$p \vdash_F p$}
        \end{prooftree}
      \item
        \begin{prooftree}
            \AxiomC{$p \vdash_F q$} \AxiomC{$q \vdash_F r$}
                        \BinaryInfC{$p \vdash_F r$}
        \end{prooftree}
      \item %$$\dfrac{p \vdash_F q}{p \vdash_{F \cup \set{y}} q}$$
        \begin{prooftree}
          \AxiomC{$p \vdash_F q$}
          \UnaryInfC{$p \vdash_{F \cup \set{y}} q$}
        \end{prooftree}
      \item %$$\dfrac{\varphi(y) \vdash_F \psi(y)}{\varphi(b) \vdash_{F\setminus\set{y}} \psi(b)}$$
        \begin{prooftree}
          \AxiomC{$\varphi(y) \vdash_F \psi(y)$}
          \UnaryInfC{$\varphi(b) \vdash_{F \setminus \set{y}} \psi(b)$}
        \end{prooftree}
      kjer je $y : B$ spremenljivka, $b$ pa term tipa $B$ in $b$ lahko zamenjamo za $y$ v obeh izrazih.
    \end{enumerate}
    \item Logična pravila
    \begin{enumerate}[label*=\arabic*]
      \item %$$\dfrac{}{p \vdash_F \top}$$
        \begin{prooftree}
          \AxiomC{}
          \UnaryInfC{$p \vdash_F \top$}
        \end{prooftree}
      \item %Če $r \vdash_F p \wedge q$, potem $r \vdash_F p$ in $r \vdash_F q$; in, če $r \vdash_F p$ in $r \vdash_F q$ potem $r \vdash_F p \wedge q$.
        \begin{prooftree}
          \AxiomC{$r \vdash_F p$}
          \AxiomC{$r \vdash_F q$}
          \doubleLine
          \BinaryInfC{$r \vdash_F p \wedge q$}
        \end{prooftree}
      \item %Če $\exists y \psi(y) \vdash_F p$, potem $\psi(y) \vdash_{F \cup \set{y}} p$; in obratno, če $\psi \vdash_{F \cup \set{y}} p$ potem $\exists y \psi(y) \vdash_F p$.
        \begin{prooftree}
          \AxiomC{$\exists y \psi(y) \vdash_F p$}
          \doubleLine
          \UnaryInfC{$\psi(y) \vdash_{F \cup \set{y}} p$}
        \end{prooftree}
    \end{enumerate}
    \item Pravila za enakost
    \begin{enumerate}[label*=\arabic*]
      \item $\top \vdash_x x = x$
      \item $x_1 = x_2 \vdash_{x_1, x_2} x_2 = x_1$
      \item $x_1 = x_2 \wedge x_2 = x_3 \vdash_{x_1, x_2, x_3} x_1 = x_3$
      \item $\overline{x}^1 = \overline{x}^2 \vdash_{\overline{x}^1, \overline{x}^2} f(\overline{x}^1) = f(\overline{x}^2)$
      \item $\overline{x}^1 = \overline{x}^2 \wedge R(\overline{x}^1) \vdash_{\overline{x}^1, \overline{x}^2} \mathrm{R}(\overline{x}^2)$
      kjer je $R \rightarrowtail \overline{X}$
    \end{enumerate}
  \end{enumerate}
  Če $F = \emptyset$ potem označimo $\vdash_\emptyset$ kot $\vdash$ in $\emptyset \vdash_F \psi$ označimo z $\vdash_F \psi$.
  Če imamo podano teorijo $T$, pišemo $T, \varphi \vdash_F \psi$, če $\varphi_F^T \psi$, kjer $\varphi_F^T$ pomeni dedukcijo po zgornjih pravilih sklepanja z dodatnim aksiomom
  $$\varphi \vdash_{\mathrm{FV}(\varphi) \cup \mathrm{FV}(\psi)} \psi$$
  za vsako sekvento $\varphi \implies \psi$ v $T$.
  Alternativno lahko to označimo z $T \vdash_F \varphi \implies \psi$, kar nakazuje, da $\varphi$ implicira $\psi$, modulo $T$.
  Izpeljave gradimo v obliki dreves, kjer so listi drevesa naše predpostavke in koren sklep izpeljave.
\end{definicija}
\begin{primer}
Poglejmo si kako bi izpeljali pravilo za vnos kvantifikatorja obstoja, ki pravi
\begin{prooftree}
  \AxiomC{$r \vdash_F \psi(t)$}
  \RightLabel{\scriptsize $\exists$-intro}
  \UnaryInfC{$r \vdash_F \exists x \psi(x)$}
\end{prooftree}
Podali bi ga v obliki drevesa
\begin{prooftree}
  \AxiomC{$r \vdash_F \psi(t)$}
  \AxiomC{}
  \RightLabel{\scriptsize(1.1)}
  \UnaryInfC{$\exists x \psi(x) \vdash_F \exists x \psi(x)$}
  \RightLabel{\scriptsize(2.3)}
  \UnaryInfC{$\psi(x) \vdash_{F \cup \set{x}} \exists x \psi(x)$}
  \RightLabel{\scriptsize(1.4)}
  \UnaryInfC{$\psi(t) \vdash_F \exists x \psi(x)$}
  \RightLabel{\scriptsize(1.2)}
  \BinaryInfC{$r \vdash_F \exists x \psi(x)$}
\end{prooftree}
\end{primer}
%
\section{Regularne kategorije}
Regularna logika ima jasno v primerjavi z algebrajskimi teorijami dodatno strukturo, ki se bo odražala v strukturi kategorije v kateri jo bomo lahko interpretirali.
Za to nalogo bo pomemben koncept podobjekta v kategoriji.
\begin{definicija}
 Naj bo $\cat{C}$ kategorija in $X \in \cat{C}$ objekt.
 \emph{Podobjekt} objekta $X$ je ekvivalenčni razred monomorfizmov $\alpha : A \rightarrowtail X$, kjer sta dva monomorfizma $\alpha$ in $\beta : B \rightarrowtail X$ ekvivalenta, če sta $A$ in $B$ izomorfna nad $X$.
 (Z drugimi besedami, če sta $A$ in $B$ isti objekt v $\cat{C}/X$). To pomeni, da obstaja tak izomorfizem $i : A \xrightarrow{\cong} B$, da diagram
 \begin{equation*}
   \begin{tikzcd}[column sep=small]
     A \ar[rr, "i"']{a}{\cong} \ar[dr, "\alpha"'] & & B \ar[dl, "\beta"] \\
     & X &
   \end{tikzcd}
 \end{equation*}
 komutira. Pogosto morfizma $\alpha$ ne navedemo eksplicitno ampak pišemo samo $A \rightarrowtail X$.
 Razred vseh podobjektov objekta $X$ označimo z $\Sub(X)$ in ga opermimo z relacijo delne urejenosti,
 kjer je $A \leq B$, če lahko $\alpha : A \rightarrowtail X$ faktoriziramo skozi podobjekt 
 $\beta : B \rightarrowtail X$.
\end{definicija}
Ta delno urejeni razred ima največji element, in sicer $\mathrm{id}_X$.
\begin{definicija}
    Pravimo da je kategorija $\cat{C}$ \emph{dobro potencirana}, če je $\Sub(X)$ množica za vsak objekt $X \in \cat{C}$.
\end{definicija}
Od sedaj naprej bomo privzeli, da je $\cat{C}$ dobro potencirana. Oglejmo si interakcijo med množico $\Sub(X)$ in nekaterimi kategoričnimi konstrukti.

Recimo, da $\cat{C}$ ima vse povleke. 
Potem lahko za vsak $X \in \cat{C}$ v množici $\Sub(X)$ tvorimo konjunkcije.
Namreč, recimo, da imamo $\alpha : A \rightarrowtail X$ in $\beta : B \rightarrowtail X$.
Potem njuno konjunkcijo predstavlja kompozitum $A \times_X B \rightarrowtail X$,
ki ga dobimo iz diagrama povleka:
\begin{equation*}
    \begin{tikzcd}
        A \times_X B \ar[r, tail] \ar[d, tail] & B \ar[d, tail, "\beta"] \\
        A \ar[r, tail, "\alpha"] & X
    \end{tikzcd}
\end{equation*}
Opazimo lahko tudi, da sta obe projekciji v povleku monomorfizma.
Naj bo sedaj $f : X \to Y$ morfizem v $\cat{C}$.
Potem dobimo s povlekom inducirano preslikavo
$$f^{-1} : \Sub(Y) \to \Sub(X),$$
ki pošlje podobjekt $\beta : B \rightarrowtail Y$ v $f^{-1}B \rightarrowtail X$,
kar lahko prikažemo v diagramu
\begin{equation*}
    \begin{tikzcd}
        f^{-1} \ar[r, tail] \ar[d, tail] & B \ar[d, tail, "\beta"] \\
        X \ar[r, "f"] & Y
    \end{tikzcd}
\end{equation*}
\begin{lema}
  Preslikava $f^{-1}$ ohranja konjunkcije.
\end{lema}
\begin{dokaz}
  To lahko razberemo iz diagrama
  \begin{equation*}
  \begin{tikzcd}[column sep=small, row sep=normal]
    & f^{-1}(B \land C) \ar[dl] \ar[dd, tail] \ar[rr, tail] & & f^{-1}C \ar[dl] \ar[dd, tail] \\
    B \land C \ar[dd, tail] \ar[rr, crossing over, tail] & & C  & \\
    & f^{-1}B \ar[dl] \ar[rr, tail] & & X \ar[dl, "f"] \\
    B \ar[rr, tail] & & Y \ar[from=uu, crossing over, tail] & 
  \end{tikzcd}
  \end{equation*}
  v katerem je zadnja stranica povlek.
\end{dokaz}

To pomeni, da za dobro pogojeno kategorijo $\cat{C}$ dobimo funktor
$$\Sub(\_) : \cat{C}^{\mathrm{op}} \to \cat{\wedge-\mathbf{SLat}},$$
ki ga imenujemo \emph{podobjektni funktor}.
\begin{definicija}
    Recimo, da je $f : X \to Y$ morfizem v $\cat{C}$. Potem paru morfizmov $(p_1, p_2)$ iz diagrama povleka
    \begin{equation*}
        \begin{tikzcd}
        X \times_Y X \ar[d, "p_1"'] \ar[r, "p_2"] & X \ar[d, "f"] \\
        X \ar[r, "f"'] & Y
        \end{tikzcd}
    \end{equation*}
    pravimo \emph{par jedra} morfizma $f$, ali \emph{par jedra} $f$, oziroma,
    če je $f$ jasen iz konteksta, kar \emph{jederni par}.
\end{definicija}
\begin{definicija}
  Epimorfizmu $f$ pravimo \emph{regularen}, če je kozožek nekega para vzporednih morfizmov.
\end{definicija}
Sedaj imamo pripravljeno vse potrebno, da definiramo regularno kategorijo.
\begin{definicija}
    Kategorija $\cat{C}$ je \emph{regularna}, če ima vse končne limite,
    če za vsak jederni par obstaja kozožek, in če povleki ohranjajo regularne epimorfizme.
\end{definicija}
\begin{primer}[Primeri regularnih kategorij]
\begin{itemize}
  \item Kategorija $\cat{Set}$ množic in funkcij je pričakovano regularna.
  \item Če je $\mathbb{T}$ algebrajska teorija, potem je kategorija modelov teorije $\mathbb{T}$ regularna kategorija.
  \item Če je $\mathbb{T}$ algebrajska teorija in $\cat{C}$ regularna,
    potem je $\cat{Mod}(\mathbb{T}, \cat{C})$ regularna.
  \item Vsaka abelova kategorija je regularna.
  \item Če je $\cat{C}$ regularna in je $\cat{D}$ poljubna kategorija,
    potem je funktorska kategorija $\cat{C}^{\cat{D}}$ regularna.
  \item Če je $\cat{C}$ regularna in $X \in \cat{C}$ potem je $\cat{C}/X$ regularna.
  \item Kategorija kompaktnih Hausdorffovih topoloških prostorov je regularna.
  \item Kategorija $\cat{Top}^{\mathrm{op}}$ je regularna.
\end{itemize}
\end{primer}
\begin{primer}[Primeri neregularnih kategorij]
  Kategorije $\cat{Cat}, \cat{Pos}\ \text{in}\ \cat{Top}$ niso regularne.
  Sledeči primer pokaže neregularnost za vse tri primere:
  Naj bo $A$ delno urejena množica $\set{a, b} \times (0 \to 1)$ in $B$ delno urejena množica
  $(0 \to 1 \to 2)$ ter $C$ delno urejena množica $(0 \to 2)$.
  Obstaja regularen epimorfizem $p : A \to B$, ki ga dobimo z identifikacijo $(a,1)$ z $(b, 0)$
  in imamo očitno inkluzijo $\dot{\imath} : C \to B$. Povlek morfizma $p$ po $\dot{\imath}$ nam da inkluzijo
  $\set{0, 2} \to (0 \to 2)$, ki je epimozfizem, a ni regularen, kar pomeni,
  da povleki v $\cat{Pos}$ ne ohranjajo regularnih epimorfizmov.

  Če delno urejene množice interpretiramo kot kategorije, isti primer deluje za $\cat{Cat}$
  in ker je kategorija končnih delno urejenih množic ekvivalentna kategoriji končnih topoloških prostorov,
  isti primer deluje tudi za kategorijo $\cat{Top}$.
\end{primer}
Poglejmo si nekaj lastnosti regularnih kategorij.
\begin{lema}
    Naj bo $\cat{C}$ regularna kategorija. Potem
    \begin{enumerate}[label=(\roman*), nosep]
        \item Vsak regularen epimorfizem je kozožek svojega para jedra.
        \item Morfizem, ki je hkrati regularen epimorfizem in monomorfizem je izo\-morfizem.
        \item Kompozitum dveh regularnih epimorfizmov je regularen epimorfizem.
        \item Če sta morfizma $f : X \to Y$ in $g : Y \to Z$ taka,
          da sta $g \circ f$ in $f$ regularna epimorfizma, potem je tudi $g$ regularen epimorfizem.
    \end{enumerate}
\end{lema}
\noindent
\begin{dokaz}
\begin{enumerate}[label=(\roman*)]
  \item  % točka (i)
    Naj bo $f : X \to Y$ kozožek morfizmov $g,h : Z \to X$ in $(p_1, p_2)$ par jedra $f$.
    Naj bo $t : X \to T$ tak, da velja $t \circ g = t \circ h$. Potem iz diagrama
    \begin{equation*}
    \begin{tikzcd}[row sep=normal, column sep=normal]
      Z \ar[ddr, bend right, "h"'] \ar[dr, dashed, "u"] \ar[drr, bend left, "g"] & & & \\
      & X \times_Y X \ar[d, "p_1"'] \ar[r, "p_2"] & X \ar[d, "f"] \ar[ddr, bend left, "t"] & \\
      & X \ar[r, "f"'] \ar[drr, bend right, "t"'] & Y \ar[dr, dashed, "v"] & \\
      & & & T
    \end{tikzcd}
    \end{equation*}
    kjer je morfizem $u$ podan z univerzalno lastnostjo povleka in morfizem~$v$
    dobimo iz univerzalne lastnosti kozožka $g$ in $h$.
    Torej je $f$ res kozožek morfizmov $p_1$ in $p_2$.
    (to je pomoje malo čudno napisano, ampak nočem pisat preveč enačb eksplicitno)

  \item % (ii)
    Naj bo $f : X \to Y$ regularen epimorfizem, ki je tudi monomorfizem.
    Ker je $f$ kozožek svojega para jedra $(p_1, p_2)$, velja $f \circ p_1 = f \circ p_2$,
    iz česar sledi $p_1 = p_2$, kajti $f$ je monomorfizem.
    Ker je $f$ kozožek, dobimo enoličen morfizem $g : Y \to X$, da je $g \circ f = \mathrm{id}_X$.
    To pa pomeni, da je~$f$ hkrati sekcija in epimorfizem, torej je izomorfizem.

  \item % (iii)
    Naj bosta $f : X \to Y$ in $g : Y \to Z$ regularna epimorfizma.
    Pokazati želimo, da je $g \circ f$ kozožek svojega jedernega para $(q_1, q_2)$,
    ki je v diagramu
    \begin{equation*}
    \begin{tikzcd}[column sep=normal]
      X \times_Z X \ar[d] \ar[r] \ar[dr, dashed, two heads, "e"]  & Y \times_Z X \ar[d ] \ar[r] & X \ar[d, two heads, "f"] \\
      X \times_Z Y \ar[d] \ar[r] & Y \times_Z Y \ar[d, "\pi_1"'] \ar[r, "\pi_2"] & Y \ar[d, two heads, "g"] \\
      X \ar[r, two heads, "f"'] & Y \ar[r, two heads, "g"'] & Z
    \end{tikzcd}
    \end{equation*}
    predstavljen kot kompozitum levega in zgornjega roba.
    Ker povleki v regularni kategoriji ohranjajo regularne epimorfizme,
    je kanonični morfizem $e$, ki je v diagramu prikazan črtkano, epimorfizem.
    Iz univerzalne lastnosti povleka dobimo še enolični morfizem $v : X \times_Y X \to X \times_Z X$
    \begin{equation*}
    \begin{tikzcd}[column sep=normal, row sep=normal]
      X \times_Y X \ar[ddr, bend right, "p_1"'] \ar[drr, bend left, "p_2"] \ar[dr, dashed, "v"] & & \\
      & X \times_Z X \ar[d, "q_1"'] \ar[r, "q_2"] & X \ar[d] \\
      & X \ar[r] & Z
    \end{tikzcd}
    \end{equation*}
    Nazadnje iz diagrama
    \begin{equation*}
    \begin{tikzcd}
      X \times_Y X \ar[dr, shift left, "p_1"] \ar[dr, shift right, "p_2"'] \ar[r, "v"] & X \times_Z X \ar[d, shift left, "q_1"] \ar[d, shift right, "q_2"'] \ar[r, "e"] & Y \times_Z Y \ar[d, shift left, "\pi_1"] \ar[d, shift right, "\pi_2"'] &  \\
      & X \ar[r, "f"] \ar[drr, "t"'] & Y \ar[r, "g"] \ar[dr, dashed, "h"] & Z \ar[d, dashed, "r"] \\
      & & & T
    \end{tikzcd}
    \end{equation*}
    razberemo, da je $(q_1, q_2)$ res kozožek morfizma $g \circ f$.

    \item  % (iv)
      Naj bosta $f : X \to Y$ in $g : Y \to Z$ taka, da sta $g \circ f$ in $f$ oba regularna epimorfizma.
      Podobno kot pri prejšnji točki, naj bo $(\pi_1, \pi_2)$ par jedra $g$ in $(q_1, q_2)$ par jedra $g \circ f$.
      Če imamo $t : Y \to T$ tak, da je $t \pi_1 = t \pi_2$ potem morfizem $tf$ zoži $q_1$ in $q_2$ in dobimo morfizem
      $h : Z \to T$, da velja $t f = h g f$. Ker je $f$ epimorfizem, res dobimo $t = h g$.
\end{enumerate}
\end{dokaz}

\noindent
Kot vidimo, imajo regularni epimorfizmi mnogo lepih lastnosti, ki smo jih vajeni iz surjektivnih funkcij v kategoriji $\cat{Set}$.
Naslednja lema nam pove, da lahko v regularni kategoriji vsak morfizem razcepimo na regularen epimorfizem,
ki mu sledi monomorfizem. 
\begin{lema}
  Naj bo $\cat{C}$ regularna kategorija in $f: X \to Y$ morfizem v~$\cat{C}$.
  Potem lahko $f$ razcepimo v kompozitum regularnega epimorfizma in monomorfizma.
  Velja še, da za vsak komutativni diagram
  \begin{equation*}
  \begin{tikzcd}
      X \ar[d, "e"'] \ar[r, "f"] & Y \ar[d, "m"] \\
      X' \ar[r, "f'"] & Y'
  \end{tikzcd}
  \end{equation*}
  v katerem je $e$ regularen epimorfizem in $m$ monomorfizem,
  obstaja enoličen diagonalni morfizem $d : X' \to Y$, tako da oba trikotnika komutirata.
  V posebnem, je zgornji razcep enoličen do izomorfizma natančno.
\end{lema}
\begin{opomba}
  Pokažimo, da zgornja trditev res pomeni, da so slike morfizmov enolične.
\end{opomba}
\begin{dokaz}
Naj bo $f : X \to Y$ morfizem.
Označimo njegov par jedra s $p_1, p_2 : X \times_Y X \rightrightarrows X$
in naj bo $q : X \to Q$ kozožek $(p_1, p_2)$.
To nam da diagram
\begin{equation*}
\begin{tikzcd}
  X \times_Y X \ar[r, shift left, "p_1"] \ar[r, shift right, "p_2"'] & X \ar[dr, "f"'] \ar[r, two heads, "q"] & Q \ar[d, dashed, "m"] \\
  & & Y
\end{tikzcd}
\end{equation*}
Dokazati moramo, da je $m$ monomorfizem. V ta namen recimo, da imamo dva morfizma $t_1, t_2 : T \to Q$,
da velja $m t_1 = m t_2$. Povlek $m$ nam da par morfizmov $(\pi_1, \pi_2) : Q \times_Y Q \to Y$
in morfizem $t : T \to  Q \times_Y Q$, da velja $t_1 = \pi_1 t$ in $t_2 = \pi_2 t$.
Podobno kot pri dokazu prejšnje leme dobimo epimorfizem $e : X \times_Y X \to Q \times_Y Q$,
ki nam da enačbi $p_1 e = q p_1$ in $\pi_2 e = q p_2$.
Ampak, ker je $q$ kozožek $p_1$ in $p_2$ dobimo $\pi_1 e = \pi_2 e$, iz česar sledi $\pi_1 = \pi_2$, 
kajti $e$ je epimorfizem.
Potem pa je $t_1 = \pi_1 t = \pi_2 t = t_2$, kar pomeni, da je~$m$ res monomorfizem.

Da pokažemo drugi del trditve, denimo, da je $(p_1, p_2)$ par jedra $e$.
Tedaj imamo enakosti $m f p_1 = m f p_2 = f' e p_1 = f' e p_2$.
Ker je $m$ monomorfizem sledi $f p_1 = f p_2$ in po univerzalni lastnosti kozožka dobimo enoličen mofizem $d : X' \to Y$,
da velja $f = d e$. Ker kvadrat komutira dobimo $f' e = m f = m d e$, kar pomeni $f' = m d$, saj je $e$ epimorfizem.
\end{dokaz}

\begin{definicija}
Monomorfizmu $m : E \hookrightarrow Y$, ki smo ga videli pri dokazu faktorizacije morfizma $f$ pravimo \emph{(direktna) slika} in ga označimo z $\mathrm{Im}(f)$.
Včasih rečemo kar objektu $E$ slika $f$. Slika morfizma je določena le do izomorfizma natančno, a določa natanko en podobjekt objekta $Y$, ki ga označimo z $\exists_f(X)$.
Oznake $\mathrm{Im}(f)$, $\exists_f(X)$ in $E$ uporabljamo izmenljivo, če je namen jasen iz konteksta.

Za podobjekt $A \overset{\alpha}{\rightarrowtail} X$ definiramo sliko kot
$$\exists_f(A) := \mathrm{Im}(f \circ \alpha),$$
kar nam da dobro definirano preslikavo $\exists_f : \Sub(X) \to \Sub(Y)$.
\end{definicija}
\begin{comment}
Če se malo poigramo s temi slikami, dobimo diagram
\begin{equation*}
\begin{tikzcd}
  A \times_Y A \ar[d, shift left , "a_1"] \ar[d, shift right, "a_2"'] \ar[r, dashed, "u"] & X \times_Y X \ar[d, shift left, "p_1"] \ar[d, shift right, "p_2"'] & \\
  A \ar[d, two heads, "a"] \ar[r, tail, "\alpha"] & X \ar[dr, "f"] \ar[r, two heads, "q"] & \exists_f X \ar[d, tail, "m"] \\
  \exists_f A \ar[rr, tail] \ar[urr, dashed, "\dot{\imath}"] & & Y
\end{tikzcd}
\end{equation*}
iz katerega lahko zaradi enoličnosti slik (do izomorfizma natančno) razberemo, da je $\dot{\imath}$ monomorfizem.
\end{comment}
\begin{lema}
  Naj bo $\cat{C}$ regularna kategorija. Naj bo $f : X \to Y$ morfizem~v~$\cat{C}$. Potem
  \begin{enumerate}[label=(\roman*)]
    \item Preslikava $\exists_f$ je monotona in levo adjungirana povleku $f^{-1}$,
      imamo torej par adjungiranih funktorjev
    $$\exists_f : \Sub(X) \rightleftarrows \Sub(Y) : f^{-1}.$$
    \item Če je $g : Y \to Z$ morfizem v $\cat{C}$, potem velja $$\exists_g \circ \exists_f = \exists_{g \circ f} : \Sub(X) \to \Sub(Z)$$
  \end{enumerate}
\end{lema}
\begin{dokaz}
  Da pokažemo monotonost, recimo da imamo dva podobjekta $A' \leq A$ v $\Sub(X)$.
  Najprej faktoriziramo $A \xhookrightarrow{\alpha} X \xrightarrow{f} Y$ in potem $A' \to \exists_f A$.
  Iz diagrama
  \begin{equation*}
  \begin{tikzcd}
    A' \ar[d, two heads] \ar[r, tail] \ar[rr, bend left, "\alpha'"] & A \ar[d, two heads] \ar[r, tail, "\alpha"] & X \ar[d, "f"] \\
    Z \ar[r, tail] & \exists_f A \ar[r, tail] & Y
  \end{tikzcd}
  \end{equation*}
  lahko razberemo, da je $A' \twoheadrightarrow Z \hookrightarrow Y$ zaradi enoličnosti to faktorizacija
  $f \circ \alpha'$ in velja $Z \cong \exists_f A' \leq \exists_f A$.

  Da pokažemo, da sta to adjungirana morfizma moramo pokazati 
  $$\Sub(X)(\exists_f A, B) \cong \Sub(Y)(A, f^{-1}B),$$
  kjer sta $A \leq X$ in $B \leq Y$. Če v diagramu
  \begin{equation*}
  \begin{tikzcd}
    A \ar[ddr, bend right, tail, "\alpha"'] \ar[dr, dashed, "g"] \ar[rr, "\rho"] & & \exists_f A \ar[d, dashed, "h"] \\
    & f^{-1}B \ar[d] \ar[r, "\pi"] & B \ar[d, tail, "\beta"] \\
    & X \ar[r, "f"] & Y
  \end{tikzcd}
  \end{equation*}
  predpostavimo, da obstaja črtkani morfizem $g$,
  potem lahko faktoriziramo $A \to B$ in dobimo monomorfizem $\exists_f A \hookrightarrow B$ po enoličnosti slik.
  Obratno, če predpostavimo da obstaja morfizem $h$ potem dobimo enolični morfizem $g$ iz univerzalne lastnosti povleka.

  Drugi del trditve sledi iz tega, da to velja za povleke in je $\exists_f$ adjungiran funktor.
\end{dokaz}
%

\noindent
Kot posledico tega lahko vidimo, da $f^{-1}$ ohranja konjunkcije v $\Sub(Y)$, kajti desni adjunkti ohranjajo limite.
\begin{lema}[Frobeniusova lema]
  Naj bo $\cat{C}$ regularna kategorija in $f : X \to Y$ morfizem v $\cat{C}$.
  Naj bosta $A \overset{\alpha}{\rightarrowtail} X$ in $B \overset{\alpha}{\rightarrowtail} Y$ dva podobjekta.
  Potem velja
  $$\exists_f(A \wedge f^{-1}B) = \exists_f(A) \wedge B,$$
  kot elementa $\Sub(Y)$.
\end{lema}
\begin{dokaz}
  V diagramu
  \begin{equation*}
  \begin{tikzcd}
    X \ar[rr, bend left, "f"] \ar[r, two heads] & \exists_f X \ar[r, tail] & Y \\
    A \ar[u, tail, "\alpha"] \ar[r, two heads] & \exists_f A \ar[u, tail] \ar[ur] & \\
    A \land f^{-1}B \ar[u, tail] \ar[r, dashed, two heads] & \exists_f A \land B \ar[r, tail] \ar[u, tail] & B \ar[uu, tail, "\beta"']
  \end{tikzcd}
  \end{equation*}
  je spodnji levi kvadrat povlek, torej je črtkani morfizem regularen epimorfizem, saj je povlek regularnega epimorfizma.
  To pa pomeni, da je kompozitum 
  $A \land f^{-1}B \twoheadrightarrow \exists_f A \land B \hookrightarrow B$
  kanonična faktorizacija morfizma $A \land f^{-1}B \to Y$, kar nam da želeno enakost.
\end{dokaz}

Še ena izmed lepih lastnosti funkcij med množicami je, da jih lahko opišemo kot njihov graf.
Izkaže se, da so regularne kategorije ravno pravo okolje za tako konstrukcijo.
\begin{definicija}
  Naj bo $f : X \to Y$ morfizem v regularni kategoriji $\cat{C}$. Potem je \emph{graf} tega morfizma podobjekt
  $$\graph(f) \rightarrowtail X \times Y,$$
  ki ga definiramo kot sliko morfizma $\fprod{\mathrm{id}_X, f}$.
\end{definicija}

Opazimo lahko, da je kanonični morfizem $X \to \graph(f)$ izomorfizem,
kajti po definiciji je regularen epimorfizem
in kot sekcija je monomorfizem, torej je po lemi ?? izomorfizem.
\begin{lema}
  Naj bodo oznake kot v zgornji definiciji in naj bo $A \overset{\alpha}{\rightarrowtail} X$ podobjekt. Če z $\pi_X$ in $\pi_Y$ označimo projekciji iz produkta, potem velja
  $$\exists_f(A) = \exists_{\pi_Y}(\pi_X^{-1}(A) \wedge \graph(f)).$$
\end{lema}
\begin{dokaz}
  V ta namen konstruiramo diagram
  \begin{equation*}
  \begin{tikzcd}
    & & Y & \\
    X \ar[urr, "f"] \ar[r, two heads] & \operatorname{graph}(f) \ar[r, tail] & X \times Y \ar[u, "\pi_Y"] \ar[r, "\pi_X"] & X \\
    A \ar[u, tail, "\alpha"] \ar[r, two heads] & \pi_X^{-1}A \land \operatorname{graph}(f) \ar[u, tail] \ar[r, tail] & \pi_X^{-1}A \ar[u, tail] \ar[r] & A \ar[u, tail, "\alpha"]
  \end{tikzcd}
  \end{equation*}
  kjer so kvadrati povleki.
  Levi spodnji kvadrat dobimo kot povlek zunanjega trivialnega povleka $\mathrm{id}_X$ in $\alpha$.
  Tako dobimo, da je morfizem 
  $$A \twoheadrightarrow \pi_X^{-1}A \land \operatorname{graph}(f)$$
  regularen epimorfizem.
  Torej nam da sliko morfizma $f \circ \alpha$, kar pokaže iskano enakost.
\end{dokaz}

\noindent
Sedaj bomo opisali, kako lahko dobimo nazaj morfizem iz njegovega grafa.
\begin{definicija}
  Na podobjekt $R \rightarrowtail X \times Y$ lahko gledamo kot na relacijo med ``elementi'' $X$ in $Y$. Relaciji $R$ pravimo 
  \begin{itemize}
    \item \emph{totalna}, če je $\exists_{\pi_X}R = X$ (to intuitivno pomeni, da je množica vseh tistih $x$, za katere obstaja nek $y$ za katerega velja $xRy$, enaka $X$).
    \item \emph{funkcijska}, če kanonični morfizem $R \times_X R \to X \times Y \times Y$,
      lahko faktoriziramo skozi inkluzijo 
      $\mathrm{id}_X \times \Delta_Y : X \times Y \to X \times Y \times Y$
      (tu si lahko predstavljamo, da ker $R \times_X R$ predstavlja trojice elementov $(x, y_1, y_2)$,
      za katere velja $xRy_1$ in $xRy_2$, nam ta faktorizacija omogoča,
      da iz tega izpeljemo $y_1 = y_2$).
  \end{itemize}
\end{definicija}
\begin{opomba}
  Kanonični morfizem $R \times_X R \to X \times Y \times Y$ lahko dobimo tako, da v diagramu
  \begin{equation*}
  \begin{tikzcd}[row sep=normal, column sep=small]
    R \times_X R \ar[d] \ar[r] & Y \times R \ar[d] \ar[r] & R \ar[d] \\
    R \times Y \ar[d] \ar[r] & (X \times Y) \times_X (X \times Y) \ar[d] \ar[r] & X \times Y \ar[d] \\
    R \ar[r] & X \times Y \ar[r] & X
  \end{tikzcd}
  \end{equation*}
  uporabimo izormofizem $(X \times Y) \times_X (X \times Y) \cong X \times Y \times Y$, ki ga dobimo iz diagrama povleka
  \begin{equation*}
  \begin{tikzcd}[row sep=normal, column sep=normal]
    X \times Y  \times Y\ar[d] \ar[r] & X \times Y \ar[d, "\pi_X"] \ar[r] & Y \ar[d] \\
    X \times Y \ar[r, "\pi_X"] & X \ar[r] & 1
  \end{tikzcd}
  \end{equation*}
\end{opomba}
\begin{lema}
  Naj bo $\cat{C}$ regularna kategorija.
  \begin{enumerate}[label=(\roman*)]
    \item Graf morfizma $f : X \to Y$ je totalna in funkcijska relacija na $X \times Y$.
    \item Za vsako totalno in funkcijsko relacijo $R \rightarrowtail X \times Y$ obstaja natanko en morfizem $f : X \to Y$ za katerega je $R = \graph(f)$.
  \end{enumerate}
\end{lema}
\begin{dokaz}
\begin{enumerate}[label=(\roman*)]
  \item Ker je $X \to \graph(f)$ izomorfziem, lahko faktoriziramo kompozitum
    $\graph(f) \hookrightarrow X \times Y \xrightarrow{\pi_X} X$ kot
    \begin{equation*}
    \begin{tikzcd}
      \operatorname{graph}(f) \ar[d, two heads] \ar[r, tail]  & X \times Y \ar[d, "\pi_X"] \\
      X \ar[r, tail, "\mathrm{id}_X"] & X
    \end{tikzcd}
    \end{equation*}
    Iz enoličnosti faktorizacije sledi $X \cong \exists_{\pi_X}\graph(f)$, torej je $\graph(f)$ totalna.

  \item Ker je $R$ totalna, je $R \xhookrightarrow{r} X \times Y \xrightarrow{\pi_X} X$ regularen epimorfizem,
    torej je kozožek jedernega para $(p_1, p_2)$ kar lahko predstavimo v diagramu
    \begin{equation*}
    \begin{tikzcd}[column sep=normal]
      R \times_X R \ar[ddd, bend right=30, "p_1"'] \ar[dd, tail] \ar[dr, dashed] \ar[rr, tail] \ar[rrr, bend left=20, "p_2"] & &  Y \times R \ar[dd] \ar[r] & R \ar[dd, tail, "r"] & \\
      & X \times Y \ar[dr, dashed, "\mathrm{id}_X \times \Delta_Y"'] & & & \\
      R \times Y \ar[d] \ar[rr, tail] & & X \times Y \times Y  \ar[d, "\pi_{1,2}"'] \ar[r, "\pi_{1,3}"] & X\times Y \ar[d, "\pi_X"'] \ar[ddr, "\pi_Y"] & \\
      R \ar[rr, tail, "r"] & & X \times Y \ar[r, "\pi_X"] \ar[drr, "\pi_Y"'] & X & \\
      & & & & Y
    \end{tikzcd}
    \end{equation*}
    v katerem je predstavljena tudi faktorizacija 
    $$R \times_X R \to X \times Y \xrightarrow{\mathrm{id}_X \times \Delta_Y} X \times Y \times Y,$$
    ki obstaja, ker je $R$ funkcijska relacija.
    Obe poti od $X \times Y$ do $Y$ sta samo projekciji na drugo koordinato, torej velja $\pi_Y r p_1 = \pi_Y r p_2$.
    Ker pa je $X$ kozožek svojega para jedra, obstaja enoličen morfizem $f : X \to Y$, da diagram komutira.

    Pokazati moramo še, da je $\graph(f)$ res izomorfen $R$. Za to pogledamo diagram
    \begin{equation*}
    \begin{tikzcd}
      & & & & Y \\
      R \ar[r, tail, "r"'] \ar[rr, two heads, bend left] & X \times Y \ar[r, "\pi_X"'] & X \ar[r, two heads]  \ar[rr, bend left, pos=0.3, "\fprod{\mathrm{id}_X, f}"] \ar[urr, crossing over, pos=0.75, "f"] \ar[drr, "\mathrm{id}_X"']  & \operatorname{graph}(f) \ar[r, tail] & X \times Y \ar[d, "\pi_X"] \ar[u, "\pi_Y"'] \\
      & & & & X
    \end{tikzcd}
    \end{equation*}
    v katerem je desni del samo definicja grafa morfizma $f$.
    Levi kompozitum $R \to X$ je regularen epimorfizem.
    Torej dobimo enolični morfizem $R \twoheadrightarrow \graph(f) \hookrightarrow X \times Y$,
    za katerega nam kompozitum s $\pi_X$ da $\mathrm{id}_X \pi_X r$ in kompozitum s $\pi_X$ da 
    $f \pi_X r = \pi_Y \circ \fprod{\mathrm{id}_X, f} \circ \pi_X \circ r = \pi_Y r$.
    To pa je ravno monomorfizem $r R : \hookrightarrow X \times Y$, katerega slika je kar $R$.
    Torej je $R \cong \graph(f)$.
\end{enumerate}
\end{dokaz}

Naslednja pomembna lastnost regularnih kategorij je interakcija slik in povlekov.
\begin{lema}
  Naj bo
  \begin{equation*}
    \begin{tikzcd}
      Z \times_Y X \ar[d, "f'"'] \ar[r, "g'"] & X \ar[d, "f"] \\
      Z \ar[r, "g"'] & Y
    \end{tikzcd}
  \end{equation*}
  kvadrat povleka. Potem je
  $$\exists_{g'}f^{'-1} = f^{-1}\exists_g : \Sub(Z) \to \Sub(X).$$
\end{lema}
\begin{dokaz}
  Naj bo $A \xhookrightarrow{\alpha} Z$ podobjekt.
  Situacijo lahko prikažemo v $3$D diagramu
  \begin{equation*}
  \begin{tikzcd}[column sep=small]
    A \times_Y X \ar[dd] \ar[dr, tail] \ar[rr, two heads] & & f^{-1}\exists_g A \ar[dd] \ar[dr, tail] & \\
    & Z \times_Y X  \ar[rr, crossing over] & & X \ar[dd, "f"] \\
    A \ar[dr, tail] \ar[rr, two heads] & & \exists_g A \ar[dr, tail] & \\
    & Z \ar[rr, "g"'] \ar[from=uu, pos=0.2, crossing over, "f'"] & & Y
  \end{tikzcd}
  \end{equation*}
  kjer je sprednja stranica kvadrat povleka.
  Leva stran je povlek $A$ po $f'$, spodnja stran je faktorizacija morfizma $g$,
  desna stran je povlek po $f$ in zadnja stran je tudi kvadrat povleka.
  Ker je $A \times_Y X = f'^{-1}A$, je $A \times_Y X \twoheadrightarrow f^{-1}\exists_g A \hookrightarrow X$
  ravno faktorizacija kompozituma $f'^{-1}A \hookrightarrow Z \times_Y X \to X$, kar nam da želeno enakost.
\end{dokaz}
\begin{definicija}
  Naj bosta $\cat{C}$ in $\cat{D}$ regularni kategoriji.
  Funktorju ${F : \cat{C} \to \cat{D}}$ pravimo \emph{regularen}, če ohranja končne limite in kozožke jedernih parov.
\end{definicija}
\begin{definicija}
  $\cat{RegCat}$ je kategorija v kateri so objekti majhne (ali je dovolj dobro pogojene?) kategorije in morfizmi regularni funktorji med njimi.
\end{definicija}

Ker je v kategoriji s povleki morfizem $f$ monomorfizem natanko takrat, ko je kvadrat
\begin{equation*}
  \begin{tikzcd}
    \bullet \ar[d, "\mathrm{id}"'] \ar[r, "\mathrm{id}"] & \bullet \ar[d, "f"] \\
    \bullet \ar[r, "f"] & \bullet
  \end{tikzcd}
\end{equation*}
povlek, to pomeni, da vsak regularen funktor $F : \cat{C} \to \cat{D}$ inducira, za vsak objekt $X \in \cat{C}$, preslikavo
$$F_X : \Sub_\cat{C}(X) \to \Sub_\cat{D}(F(X)),$$
ki ohranja končne konjunkcije in največji element. Torej je v posebnem tudi monotona.
Funktor $F$ pa ohranja tudi slike morfizmov, kar pomeni da, če imamo podobjekt 
$A \xhookrightarrow{\alpha} X \xrightarrow{f} Y$ potem je 
$$F(\exists_f A) = \exists_{F(f)}(F(A)),$$
kajti $\exists_f A$ je definiran kot kozožek para jedra $f \circ \alpha : A \to Y$.
To pomeni
\begin{lema}
  Regularen funktor med regularnima kategorijama ohranja povleke in slike.
  \hfill$\Box$
\end{lema}
%
\section{Model regularnega jezika}
Recimo, da imamo regularen jezik $\mathcal{L}(\Sigma)$. Kot smo to storili za algebrajsko teorijo, bi radi definirali model tega jezika v neki regularni kategoriji.
Za to najprej potrebujemo interpretacijo.
\begin{opomba}
  Za definicijo interpretacije bomo potrebovali končne produkte in zožke, ki so v splošnem določeni le do izomorfizma natančno. Privzeli bomo, da lahko vedno \emph{izberemo} nek objekt, ki produkt oziroma zožek predstavlja. To pa pomeni, da moramo privzeti neko verzijo Aksioma Izbire.
\end{opomba}
\begin{definicija}
  Naj bo $\mathcal{L}(\Sigma)$ jezik. Potem \emph{interpretacija} $M$ v kategoriji $\cat{C}$ sestoji iz:
  \begin{itemize}
    \item Objekta $X^{(M)}$ v $\cat{C}$, za vsak osnovni tip $X \in \underline{\mathrm{sort}}_\Sigma$
    \item Morfizma $c^{(M)} : 1 \to X^{(M)}$ za vsako konstanto $c \in \underline{\mathrm{const}}_\Sigma$. Tu je $1$ končni objekt v $\cat{C}$.
    \item Morfizma $f^{(M)}  : X_1^{(M)} \times \ldots \times X_n^{(M)} \to Y^{(M)}$ za vsak funkcijski simbol $f : X_1 \times \ldots \times X_n \to Y \in \underline{\mathrm{func}}_\Sigma$.
    \item Podobjekta $R^{(M)} \rightarrowtail X_1^{(M)} \times \ldots \times X_n^{(M)}$ za vsak relacijski simbol\\ $R \rightarrowtail X_1 \times \ldots \times X_n \in \underline{\mathrm{rel}}_\Sigma$.
  \end{itemize}
  Produkt $X_1^{(M)} \times \ldots \times X_n^{(M)}$ označimo z $\overline{X}^{(M)}$. 
  Interpretacijo $M$ bomo razširili na vse terme in formule jezika.
  Za term $t$ tipa $Y$ s prostimi spremenljivkami med $\overline{z} : \overline{Z}$ bomo predpisali morfizem $t(\overline{z})^{(M)} : \overline{Z}^{(M)} \to Y^{(M)}$, za formulo $\varphi$ s prostimi spremenljivkami med $\overline{z} : \overline{Z}$ pa predpišemo podobjekt $\set{\overline{z} \mid \varphi}^{(M)}$ objekta $\overline{Z}^{(M)}$ po naslednjih pravilih:
  \begin{itemize}
    \item[(T1)] Če je $x$ spremenljivka tipa $X$ potem $x(\overline{z})^{(M)}$ definiramo kot kompozitum $\overline{Z}^{(M)} \xrightarrow{\pi} X^{(M)} \xrightarrow{\mathrm{id}_X}$. Tu je $\mathrm{id}_X$ tisti, ki interpretira $x$, medtem, ko je projekcija $\pi$ potrebna zaradi ``slepih'' spremenljivk, ki nastopajo v $\overline{z}$. (Opomnimo, da po predpostavki proste spremenljivke v termu $x$ (torej spremenljivka $x$ sama) nastopajo v $\overline{z}$).
    \item[(T2)] Če je $c:X$ konstanta, potem $c(\overline{z})^{(M)}$ interpretiramo kot kompozitum $\overline{Z} \to 1 \xrightarrow{c^{(M)}} X^{(M)}$.
    \item[(T3)] Naj bo $f : X_1 \times \ldots \times X_n \to Y$ funkcijski simbol in $t_i$ term tipa $X_i$ za $i \in \set{1, \ldots, n}$. Po indukciji imamo interpretacije $t_i(\overline{z})^{(M)} : \overline{Z}^{(M)} \to X_i^{(M)}$. Potem term $f(t_1, \ldots, t_n)$ interpretiramo kot kompozitum
    $$f^{(M)}(t_1^{(M)}, \ldots, t_n^{(M)}) : \overline{Z}^{(M)} \xrightarrow{\fprod{t_1^{(M)}, \ldots, t_n^{(M)}}} \overline{X}^{(M)} \xrightarrow{f^{(M)}} Y^{(M)}.$$
    \item[(F1)] Formuli $t_1 = t_2$ priredimo podobjekt $\set{\overline{z} \mid t_1 = t_2}^{(M)}$, ki ga definiramo kot zožek morfizmov
    \begin{tikzcd}[column sep=huge]\overline{Z}^{(M)} \ar[r, shift left, "t_1(\overline{z})^{(M)}"] \ar[r, shift right, "t_2(\overline{z})^{(M)}"'] & X^{(M)}\end{tikzcd}.
    \item[(F2)] $\set{\overline{z} \mid R(t_1, \ldots, t_n)}^{(M)}$ je podobjekt $\overline{Z}^{(M)}$ definiran kot povlek v diagramu
    \begin{equation*}
      \begin{tikzcd}
        \set{\overline{z} \mid R(t_1, \ldots, t_n)}^{(M)} \ar[d] \ar[r, hook] & \overline{Z}^{(M)} \ar[d, "\fprod{t_1^{(M)}, \ldots ,t_n^{(M)}}"] \\
        R^{(M)} \ar[r, hook] & \overline{X}^{(M)}
      \end{tikzcd}
    \end{equation*} 
    \item[(F3)] $\set{\overline{z} \mid \top}^{(M)}$ je enak $\overline{Z}^{(M)}$.
    \item[(F4)] $\set{\overline{z} \mid \varphi \wedge \psi}^{(M)} = \set{\overline{z} \mid \varphi}^{(M)} \wedge \set{\overline{z} \mid \psi}^{(M)}$.
    \item[(F5)] $\set{\overline{z} \mid \exists x \varphi}^{(M)} = \exists_{\pi}\set{(y, \overline{z}) \mid \varphi}^{(M)}$, kjer je $\pi$ projekcija\\ $Y^{(M)} \times \overline{Z}^{(M)} \xrightarrow{\pi} \overline{Z}^{(M)}$.
  \end{itemize}
\end{definicija}
\begin{definicija}
  Interpretaciji $M$ pravimo \emph{model} za sekvento $\varphi \implies \psi$, kar označimo kot
  $$M \models \varphi \implies \psi$$
  če velja $\set{\overline{x} \mid \varphi}^{(M)} \leq \set{\overline{x} \mid \psi}^{(M)}$ kot podobjekta $\overline{X}^{(M)}$, kjer je $\overline{x}$ množica prostih spremenljivk, ki nastopajo prosto v $\varphi$ ali $\psi$. Interpretacija $M$ je model teorije $T$, če je model vsake sekvente v $T$. To označimo z $M \models T$.
\end{definicija}

Da je $M$ model $\varphi \implies \psi$ je v $\cat{Set}$ to ekvivalentno temu, da je $M$ model (v klasičnem smislu) formule $\forall \overline{x} (\varphi \rightarrow \psi)$. To je intuicija, ki jo je dobro imeti v mislih.
\begin{primer}
  Naj bo $\mathcal{L}(\Sigma)$ jezik iz primera \ref{primer:kompozitum} s tremi tipi $X,Y,Z$ in funkcijskimi simboli $f : X \to Y$, $g : Y \to Z$ in $h : X \to Z$. Potem za interpretacijo $M$ v regularni kategoriji $\cat{C}$ velja da je $M$ model formule $f(g(x)) = h(x)$, oziroma
  $$M \models \top \implies f(g(x)) = h(x).$$ 
  Poglejmo si ta primer bolj detajlno.
  Edina prosta spremenljivka, ki nastopa v tej formuli je $x$. Gledamo torej interpretacijo
  $\set{x \,\middle|\, f(g(x)) = h(x)}^{(M)}$, ki je realizirana kot zožek 
  \begin{equation*}
    \begin{tikzcd}
      \set{x \,\middle|\, f(g(x)) = h(x)}^{(M)} \ar[r, hook] & X^{(M)} \ar[r, "x^{(M)}"] & X^{(M)} \ar[r, "f^{(M)}"] \ar[rr, bend right, "h^{(M)}"] & Y^{(M)} \ar[r, "g^{(M)}"] & Z^{(M)}
    \end{tikzcd}
  \end{equation*}
  Po definiciji ta formula velja, ko je $\set{x \,\middle|\, \top}^{(M)} = X^{(M)} \leq \set{x \,\middle|\, f(g(x)) = h(x)}^{(M)}$ kot podobjekt $X^{(M)}$.
  To pa velja natanko takrat, ko sta $f^{(M)} \circ g^{(M)}$ in $h^{(M)}$ isti morfizem v $\cat{C}$.
\end{primer}
Z interpretacijo teorije v rokah se lahko vprašamo, ali le-ta lepo sodeluje s pravili sklepanja, ki smo jih definirali za regularno logiko.
Bolj natančno, ali so tako-definirana pravila sklepanja veljavna glede na modele te teorije.
Za to bomo najprej potrebovali dve tehnični lemi o ``slepih spremenljivkah'' in substituciji.
\begin{lema}
  Naj bo $\varphi$ formula s prostimi spremenljivkami izmed $\overline{z} = (z_1, \ldots, z_n)$.
  Naj bo $\pi : \overline{Z}^{(M)} \times Y^{(M)} \to \interp{\overline{Z}}$ projekcija. Potem je
  $$\set{(y, \overline{}) \,\middle|\, \varphi}^{(M)} = \pi^{-1} \set{\overline{z} \,\middle|\, \varphi}^{(M)}.$$
\end{lema}
\begin{dokaz}
  Z indukcijo po strukturi $\varphi$. Najprej za terme $t$ tipa $X$ dokažemo, da
  $$t(y, \overline{z})^{(M)} = t(\overline{z})^{(M)} \circ \pi : Y^{(M)} \times \interp{\overline{Z}} \to \interp{\overline{Z}}.$$
\end{dokaz}

\noindent
Kot posledico te leme, lahko vedno pišemo $t^{(M)}$ namesto $t(\overline{z})^{(M)}$,
saj so tej morfizmi enolično določeni,
če poznamo morfizem za primer $\overline{z} = \operatorname{FV}(\varphi)$.
Sedaj še rezultat, ki nam pove kako se obnaša interpretacija pri substituciji spremenljivk.
\begin{lema}
  Naj bo $\psi$ formula s prostimi spremenljivkami izmed $y, \overline{z}$ in $b$ term tipa $Y$ (s prostimi spremenljivkami izmed $\overline{z}$), 
  ki je ``zamenljiv'' za $y$ v $\psi$, kar pomeni, da po substituciji nobena prosta spremenljivka v $b$ ne postane vezana v $\psi(b)$.
  Potem je 
  $$\set{\overline{z} \,\middle|\, \psi(b)}^{(M)} = \langle b^{(M)}, \mathrm{id}_{\interp{\overline{Z}}}\rangle^{-1} \set{(y, \overline{z}) \,\middle|\, \psi}^{(M)}$$
\end{lema}
\begin{dokaz}
  Z indukcijo na strukturo $\psi$.
\end{dokaz}
\begin{definicija}
Razred morfizmov teorije $T$ v regularni kategoriji $\cat{C}$ bi radi opremili s strukturo regularne kategorije,
ki jo bomo označili z $\Mod(T, \cat{C})$. Morfizem med dvema modeloma $M$ in $N$ v $\Mod(T, \cat{C})$ je družina morfizmov
$$\set{h_X : \interp{X} \to \interp[N]{X}}_{X \in \underline{\mathrm{sort}}_\Sigma},$$
ki komutirajo z interpretacijami osnovnih operacija jezika $\mathcal{L}(\Sigma)$.
\end{definicija}
To z indukcijo razširimo na vse terme in formule. Če imamo npr.\ konstanto $c:X$ in funkcijski simbol $f:\overline{X} \to Y$,
potem diagrama
\begin{equation*}
  \begin{tikzcd}
    1 \ar[dr, "c^{(N)}"'] \ar[r, "\interp{c}"] & \interp{X} \ar[d, "h_X"]  &&  \interp{\overline{X}} \ar[d, "h_{X_1} \times \ldots \times h_{X_n}"'] \ar[r, "\interp{f}"] & \interp{Y} \ar[d, "h_Y"]\\
    & \interp[N]{X} && \interp{\overline{X}} \ar[r, "{\interp[N]{f}}"'] & \interp[N]{Y}
  \end{tikzcd}
\end{equation*}
komutirata. Za relacijski simbol $R \rightarrowtail \overline{X}$ pa to pomeni, da kompozitum
$$(h_{X_1} \times \ldots \times h_{X_n}) \circ \interp{i} : \interp{R} \to \interp{\overline{X}} \to \interp[N]{\overline{X}}$$
lahko faktoriziramo skozi inkluzijo $\interp[N]{R} \hookrightarrow \interp[N]{X}$.
Po indukciji potem velja, da za vsak term $t(\overline{z})$ tipa $Y$ diagram
\begin{equation*}
  \begin{tikzcd}
    \interp{\overline{Z}} \ar[d, "h_{\overline{Z}}"'] \ar[r, "{t(\overline{z})^{(M)}}"] & \interp{Y} \ar[d, "h_Y"] \\
    \interp[N]{\overline{Z}} \ar[r, "{\interp[N]{t(\overline{z})}}"'] & \interp[N]{Y}
  \end{tikzcd}
\end{equation*}
komutira (tu je $h_{\overline{Z}}$ mišljen kot $h_{Z_1 \times \ldots \times Z_n}$).
Podobno z indukcijo pokažemo, da za vsako formulo $\varphi(\overline{z})$ kompozitum
$$\interp{\set{\overline{z} \,\middle|\, \varphi}} \hookrightarrow \interp{\overline{Z}} \to \interp[N]{\overline{Z}}$$
lahko faktoriziramo skozi $\interp[N]{\set{\overline{z} \,\middle|\, \varphi}}$.
\begin{definicija}
  Naj bo $F : \cat{C} \to \cat{D}$ regularen funktor med regularnima kategorijama.
  Če je $M$ model teorije $T$ (formulirane v jeziku $\mathcal{L}(\Sigma)$) v $\cat{C}$,
  potem definiramo interpretacijo $F(M)$ jezika $\mathcal{L}(\Sigma)$ v $\cat{D}$ kot
  \begin{itemize}
    \item Za tip $X$ iz $\underline{\mathrm{sort}}_\Sigma$ definiramo $\interp[F(M)]{X} = F(\interp{X})$
    \item Za konstanto $c:X$ definiramo $\interp[F(M)]{c} = F(\interp{x})$
    \item Za funkcijski simbol $f : \overline{X} \to Y$ definiramo $\interp[F(M)]{f} = F(\interp{f})$
    \item Za relacijski simbol $R \rightarrowtail \overline{X}$ definiramo $\interp[F(M)]{R} = F(\interp{R}) \rightarrowtail \overline{X}$
  \end{itemize}
\end{definicija}
S to definicijo velja
\begin{lema}
  Vsak regularen funktor $F : \cat{C} \to \cat{D}$ med regularnima kategorijama inducira,
  za vsako regularno teorijo $T$ funktor
  $$\Mod(T, \_)=F_T : \Mod(T,\cat{C}) \to \Mod(T, \cat{D})$$
  V posebnem imamo funktor $\cat{RegCat} \to \cat{Cat}$ iz kategorije majhnih regularnhi kategorij v majhne kategorije.
\end{lema}
\begin{dokaz}
  Najprej z indukcijo razširimo interpretacijo $F(M)$ na vse terme in formule jezike $\mathcal{L}(\Sigma)$.
\end{dokaz}
Po drugi strani, če je $M$ fiksen model teorije $T$ v regularni kategoriji $\cat{E}$
dobimo za vsako regualarno kategorij $\cat{D}$ funcktor
$$\mathfrak{M}_{M,\cat{D}} = (\_)_T(M): \cat{RegCat}(\cat{E}, \cat{D}) \to \Mod(T, \cat{D}),$$
ki pošlje funktor $G : \cat{E} to \cat{D}$ v model $G(M)$ v $\cat{D}$.
Naravno transformacijo $\alpha : G \to H$ pošlje v morfizem modelov
$$\set{\alpha_{\interp{X}}: G(\interp{X}) \to H(\interp{X})}_{X \in \underline{\mathrm{sort}}_{\Sigma}}.$$
Dodatno velja, da če imamo regularen funktor $F : \cat{D} \to \cat{C}$, potem diagram funktorjev
\begin{equation}
  \begin{tikzcd}
    \cat{RegCat}(\cat{E}, \cat{D}) \ar[d, "F \circ (\_)"'] \ar[r, "\mathfrak{M}_{M,\cat{D}}"] & \Mod(T, \cat{D}) \ar[d, "F_T"] \\
    \cat{RegCat}(\cat{E}, \cat{C}) \ar[r, "\mathfrak{M}_{M,\cat{C}}"'] & \Mod(T, \cat{C})
  \end{tikzcd}
\end{equation}
komutira.
\subsection{Veljavnost}
Pripravili smo si vse potrebno, da lahko govorimo o veljavnosti pravil sklepanja, ki smo jih definirali za regularno logiko,
glede na interpretacijo v regularni kategoriji.
\begin{izrek}[Veljavnost]
  Naj bo $T$ regularna teorija formulirana v jeziku $\mathcal{L}(\Sigma)$ in $M$ model te teorije v regualrni kategoriji $\cat{C}$.
  Če $T, \varphi \vdash_{\overline{x}} \psi$, potem je $M \models \varphi \implies \psi$,
  oziroma je $\set{\overline{x} \,\middle|\, \varphi}^{(M)} \leq \set{\overline{x} \,\middle|\, \psi}^{(M)}$, kot podobjekta $\interp{X}$.
\end{izrek}
\begin{dokaz}
  Z indukcijo po derivacijah $\varphi \vdash_{\overline{x}}^{T} \psi$
\end{dokaz}
%
\section{Interna logika regularne kategorije}
Naj bo $\cat{C}$ regularna kategorija.
Priredili ji bomo signaturo $\Sigma_\cat{C}$ in regularen jezik na naslednji način:
Signatura $\Sigma_\cat{C}$ ima za osnovne tipe objekte kategorije $\cat{C}$.
Fiksiramo končni objekt in za vsak končen seznam objektov fiksiramo objekt, ki predstavlja njihov produkt.
Tu torej spet uporabimo aksiom izbire. Potem
\begin{itemize}
  \item Za vsak morfizem $c : 1 \to X$ v jezik dodamo konstanto $c:X$
  \item Za vsak morfizem $f : \overline{X} \to Y$ v jezik dodamo funkcijski simbol $f : \overline{X} \to Y$
  \item Za vsak podobjekt $R \hookrightarrow \overline{X}$ v jezik dodamo en relacijski simbol $R \rightarrowtail \overline{X}$
\end{itemize}
Jezik $\mathcal{L}(\Sigma_\cat{C})$ ima sedaj kanonično interpretacijo $I^{\cat{C}}$ v $\cat{C}$.
Teorijo $T_\cat{C}$ definiramo kot teorijo te interpretacije, torej množico vseh sekvent
$\varphi \vdash_F \psi$ v jeziku $\mathcal{L}(\Sigma_\cat{C})$, ki so resnične pod interpretacijo $I^\cat{C}$.
V imenu zlorabe notacije bomo namesto $I^\cat{C}$ pisali kar $\cat{C}$, 
hkrati pa tudi ne bomo ločevali med npr.\ funkcijskim simbolom $f$ v tem jeziku in njegovo interpretacijo $f^{(I^\cat{C})}$ v $\cat{C}$.
Sedaj lahko s pomočjo jezika regularne teorije opišemo kategorične pojme.
\begin{lema}
  Naj bo $\cat{C}$ regularna kategorija. Potem
  \begin{enumerate}[label=(\roman*)]
    \item Naj bodo $A \xrightarrow{f} B \xrightarrow{g} C$ in $A \xrightarrow{h} C$ morfizmi v $\cat{C}$.
    Potem je $h = g \circ g$ natanko takrat, ko velja $\cat{C} \models h(x) = g(f(x))$, kjer je $x$ prosta spremenljivka tipa $A$.
    \item Morfizem $m : X \to Y$ je monomorfizem natanko takrat, ko velja $\cat{C} \models m(x_1) = m(x_2) \implies x_1 = x_2$.
    \item Morfizem $f : X \to Y$ je regularen epimorfizem natanko, ko velja $\cat{C} \models \exists x f(x) = y$.
  \end{enumerate}
\end{lema}
\begin{dokaz}
  sorry
\end{dokaz}
Naslednja lema karakterizira končne limite v regularni kategoriji v internem jeziku regularne kategorije, ki smo ga definirali zgoraj.
\begin{lema}
  Naj bo $\cat{C}$ regularna kategorija. Potem
  \begin{enumerate}[label=(\roman*)]
    \item Objekt $X$ v $\cat{C}$ je končen natanko takrat, ko velja $\cat{C} \models x_1 = x_2$ in $\cat{C} \models \exists x . x=x$.
    \item Morfizma $f : Z \to X$ in $g : Z \to Y$ določita $Z$ kot produkt $X$ in $Y$ natanko takrat,
    ko velja $\cat{C} \models f(z_1) = f(z_2) \wedge g(z_1) = g(z_2) \implies z_1 = z_2$ in 
    $\cat{C} \models \exists z(f(z) = x \wedge g(z) = y)$.
    \item Če imamo diagram \begin{tikzcd}[column sep=normal] Z \ar[r, "e"] & X \ar[r, shift left, "f"] \ar[r, shift right, "g"'] & Y \end{tikzcd},
    tako da velja $f e = g e$, potem je $Z$ zožek $f$ in $g$ natanko takrat, ko je $e$ monomorfizem in
    $\cat{C} \models f(x) = g(x) \implies \exists z . e(z) = x$. To lahko izrazimo s predikatom $Z$,
    ki ga določa podobjekt $Z \hookrightarrow X$ kot $\cat{C} \models f(x) = g(x) \implies Z(x)$.
  \end{enumerate}
\end{lema}
\begin{dokaz}
  sorry.
\end{dokaz}

\noindent
Prejšnje leme pokažejo, da lahko vse lastnosti, ki določajo regularno kategorijo izrazimo v interni logiki regularne kategorije.
Na ta način lahko izrazimo tudi regularne funktorje.
Če je $F : \cat{C} \to \cat{D}$ funktor med regularnima kategorijama (ki ni nujno regularen), potem dobimo interpretacijo $\mathfrak{F}$ signature $\Sigma_\cat{C}$ (oziroma njen funkcijski del) na sledeč način:
\begin{itemize}
  \item $\interp[\mathfrak{F}]{X} = F(X)$, za $X \in \underline{\mathrm{sort}}_{\Sigma}$.
  \item $\interp[\mathfrak{F}]{f} : \interp[\mathfrak{F}]{X} \to \interp[\mathfrak{F}]{Y} = F(f : X \to Y)$, za morfizem $f: X \to Y$ v $\cat{C}$.
\end{itemize}
\begin{lema}
  Funktor $F$ je regularen natanko takrat, ko velja $\mathfrak{F} \models T_\cat{C}$.
\end{lema}
\begin{dokaz}
  sorry.
\end{dokaz}
%
\section{Generični model in polnost regularnih teorij}
V primeru algebrajskih toerij smo videli, da za vsako algebrajsko teorijo $\mathbb{T}$ obstaja poseben model $\mathcal{U}$,
ki smo ga imenovali generični model teorije $\mathbb{T}$, za katerega velja, da je dokazljivost v teoriji envivalentna veljavnosti v $\mathcal{U}$.
Dobili smo tudi ekvivalenco med kategorijama modelov algebrajske teorije in kategorijo funktorjev, ki ohranjajo končne produkte
$$\Hom_{\mathrm{FP}}(\cat{C}_{\mathbb{T}}, \cat{C}) \simeq \Mod(\mathbb{T}, \cat{C}).$$
Izkaže se, da je podobno konstrukcijo mogoče ponoviti za regularne teorije.
Za teorijo $T$ bomo konstruirali regularno kategorijo $\mathcal{R}(T)$, ki bo inducirala ekvivalenco kategorij
$$\Mod(T, \cat{C}) \simeq \cat{RegCat}(\mathcal{R}(T), \cat{C})$$
naravno v $\cat{C}$. Analogno kot pri algebrajskih kategorijah bo $\mathcal{R}(T)$ vsebovala \emph{konzervativen model} teorije $T$,
za katerega se bosta pojma veljavnosti in dokazljivosti ujemala.
\begin{definicija}
  Naj bo $T$ fiksna regularna teorija. Konstruirali bomo $\mathcal{R}(T)$ kot Lindenbaum-Tarski kategorijo:
  \begin{itemize}
    \item \emph{Objekti} so ekvivalenčni razredi parov $(\overline{X}, p(\overline{x}))$,
      kjer je $\overline{x} : \overline{X}$ končna množica tipov in je $p$ regularna formula.
      $\overline{X}$ imenujemo \emph{kontekst} za $p$. Ekvivalentne so lahko le formule v istem kontekstu.
      Dva taka para $(\overline{X}, p_1(\overline{x}_1))$ in $(\overline{X}, p_2(\overline{x}_2))$ sta ekvivalentna, če
      $$T \vdash_{\overline{x}} p_1(\overline{x}) \Leftrightarrow p_2(\overline{x})$$
      kjer je $\overline{x}$ množica svežih(?) spremenljivk tipa $\overline{X}$.
      Ekvivalenčne razrede označimo z $\set{\overline{x} \,\middle|\, p}$ in konteksta ne pišemo eksplicitno.
      (Tu smo na nek način vezali spremenljivke $\overline{x}$, ki se pojavljajo v $p$)(ne razumem točno tega stavka)
    \item \emph{Morfizem} od $\set{\overline{x} \,\middle|\, p}$ do $\set{\overline{y} \,\middle|\, q}$
      je ekvivalenčni razred regularnih formul v kontekstu $(\overline{X}\overline{Y}, \gamma(\overline{x},\overline{y}))$,
      kjer je $\gamma$ dokazljivo funkcijska:
      \begin{align*}
        &T \vdash_{\overline{x},\overline{y}} \gamma(\overline{x},\overline{y})  \implies p(\overline{x}) \wedge q(\overline{y}) \\
        &T \vdash_{\overline{x}} p(\overline{x}) \implies \exists \overline{y} \gamma(\overline{x},\overline{y}) \\
        &T \vdash_{\overline{x},\overline{y}_1,\overline{y}_2} \gamma(\overline{x},\overline{y}_1) \wedge \gamma(\overline{x},\overline{y}_2) \implies \overline{y}_1 = \overline{y}_2
      \end{align*}
      kar intuitivno pravi, da je $\gamma$ graf funkcije. Dve taki formuli v kontekstu sta ekvivalentni, če sta dokazljivo ekvivalentni v $T$.
      Ekvivalenčni razred take formule označimo z $\set{(\overline{x},\overline{y}) \,\middle|\, \gamma(\overline{x},\overline{y})}$, ali krajše kar z $\set{\gamma}$.
    \item Kompozitum dveh morfizmov $\set{\gamma} : \set{\overline{x} \,\middle|\, p} \to \set{\overline{y} \,\middle|\, q}$ in
      $\set{\chi} : \set{\overline{y}\,\middle|\, q} \to \set{\overline{z}\,\middle|\, r}$ je podan z ekvivalenčnim razredom formule
      $$\exists \overline{x}(\gamma(\overline{y},\overline{x}) \wedge \chi(\overline{x},\overline{z}))$$
  \end{itemize}
\end{definicija}
\begin{lema}
  Kompozitum dveh morfizmov v $\mathcal{R}(T)$ je dobro definiran.
\end{lema}
\begin{dokaz}
  sorry
\end{dokaz}

\noindent
Iz konstrukcije je jasno, da dobimo majhno kategorijo.
\begin{lema}
  Kategorija $\mathcal{R}(T)$ ima vse končne limite
  \begin{enumerate}[label=(\roman*)]
    \item Objekt $\set{\cdot \,\middle|\, \top}$ (ekvivalenčni razred formul v kontekstu $(\emptyset, \top)$) je končni objekt v $\mathcal{R}(T)$.
    \item Produkt objektov $\set{\overline{x}\,\middle|\, p}$ in $\set{\overline{y}\,\middle|\, q}$ je podan z objektom
      $\set{(\overline{x},\overline{y})\,\middle|\, p \wedge q}$.
      Projekcija na $\set{\overline{x}\,\middle|\, p}$ je podana z ekvivalenčnim  razredom 
      $$\set{(\overline{x}\overline{y},\overline{x}')\,\middle|\, p(\overline{x}) \wedge q(\overline{y}) \wedge \overline{x} = \overline{x}'}.$$
      Projekcija na $\set{\overline{y}\,\middle|\, q}$ pa z ekvivalenčnim razredom
      $$\set{(\overline{x}\overline{y},\overline{y}')\,\middle|\, p(\overline{x}) \wedge q(\overline{y}) \wedge \overline{y} = \overline{y}'}.$$
    \item Zožek dveh morfizmov $\set{\gamma}, \set{\gamma'} : \set{\overline{x}\,\middle|\, p} \to \set{\overline{y}\,\middle|\, q}$
      je podan z objektom $E = \set{\overline{x}\,\middle|\, \epsilon(\overline{x})}$ kjer je 
      $$\epsilon(\overline{x}) \equiv \exists \overline{y}\left(\gamma(\overline{x},\overline{y}) \wedge \gamma'(\overline{x},\overline{y})\right)$$
      in morfizmom $\set{(\overline{x},\overline{x}')\,\middle|\, \epsilon(\overline{x}) \wedge \overline{x} = \overline{x}'}$.
    \item Povlek dveh morfizmov $\set{\varphi} : \set{\overline{x}\,\middle|\, p} \to  \set{\overline{z}\,\middle|\, r}$ in $\set{\gamma} : \set{\overline{y}\,\middle|\, q} \to \set{\overline{z}\,\middle|\, r}$
      je podan z objektom 
      $$\set{(\overline{x},\overline{y})\,\middle|\, \exists \overline{z} \left(\varphi(\overline{x},\overline{z}) \wedge \gamma(\overline{y},\overline{z})\right)}$$
      in kanoničnima projekcijama.
  \end{enumerate}
\end{lema}
\begin{opomba}
  Opazimo, da so v $\mathcal{R}(T)$ vse limite podane enolično, ne samo enolično do izomorfizma,
  saj smo objekte podali kot ekvivalenčne razrede. Definicija kategorije bi delovala tudi, če tega nebi storili, a to omogoča sledeči dokaz.
\end{opomba}
\begin{dokaz}
  Uporabljali bomo lastnosti relacije $\vdash^T$.
\end{dokaz}
\begin{lema}
  Morfizem $\set{\varphi} : \set{\overline{x}\,\middle|\, p} \to \set{\overline{y}\,\middle|\, q}$ je
  \begin{enumerate}[label=(\roman*)]
    \item monomorfizem natanko takrat, ko
      $$T \vdash_{\overline{x}_1,\overline{x}_2}  \exists \overline{y} \left( \varphi(\overline{x}_1,\overline{y}) \wedge \varphi(\overline{x}_2,\overline{y}) \implies \overline{x}_1 = \overline{x}_2 \right),$$
    \item regularen epimorfizem natanko takrat, ko
      $$T \vdash_{\overline{y}} q(\overline{y}) \implies \exists \overline{x} \varphi(\overline{x},\overline{y}).$$
    \item Morfizem $\set{p(\overline{x}) \wedge \overline{x}, = \overline{x}'} : \set{\overline{x}\,\middle|\, p } \to \set{\overline{x}\,\middle|\, q}$ je monomorfizem natanko takrat, ko
      $$T \vdash_{\overline{x}} p \implies q.$$
  \end{enumerate}
\end{lema}
\begin{dokaz}
  sorry.
\end{dokaz}
\begin{trditev}
  $\mathcal{R}(T)$ je regularna kategorija.
\end{trditev}
\begin{dokaz}
  sorry
\end{dokaz}
\begin{definicija}
  Kategorija $\mathcal{R}(T)$ vsebuje kanonično interpretacijo $\mathcal{U}$ jezika $\mathcal{L}(\Sigma)$:
  \begin{itemize}
    \item $\interp[\mathcal{U}]{X} = \set{x\,\middle|\, x = x}$, kjer je $x$ spremenljivka tipa $X$.
    \item $\interp[\mathcal{U}]{c} = \set{x\,\middle|\, x = c} : \set{\cdot\,\middle|\, \top} \to \interp[\mathcal{U}]{X}$, kjer je $c:X$ konstanta.
    \item $\interp[\mathcal{U}]{f} = \set{(\overline{x}y)\,\middle|\, f(\overline{x}) = y}$,
      kjer je $f : \overline{X}\to Y$ funkcijski simbol. Uporabimo dejstvo, da je $\overline{X}^{(\mathcal{U})} = \interp[\mathcal{U}]{\bar{X}_1} \times \ldots \times \interp[\mathcal{U}]{\bar{X}_n}$
    \item $\interp[\mathcal{U}]{R} = \set{\overline{x}\,\middle|\, R(\overline{x})}$, kjer je $R$ relacijski simbol.
  \end{itemize}
\end{definicija}
\noindent
Enostavna indukcija (napiši to indukcijo) pokaže, da je za term $t(\overline{z})$ tipa $Y$
$$\caninterp{t(\overline{z})} = \set{(\overline{z}y)\,\middle|\, t(\overline{z}) = y}$$
morfizem $\caninterp{\overline{Z}} \to \caninterp{Y}$. Podobno za regularno formulo $\varphi(\overline{z})$ velja 
$$\caninterp{\set{\overline{z}\,\middle|\, \varphi}} = \set{\overline{z}\,\middle|\, \varphi}.$$
Sledi, da je $\mathcal{U}$ model teorije $T$, kajti če je $\varphi \implies \psi$ sekventa v $T$,
potem je $\set{(\overline{x}, \overline{x}')\,\middle|\, p(\overline{x}) \wedge \overline{x}= \overline{x}'}$
monomorfizem iz $\set{\overline{x}\,\middle|\, p}$ v $\set{\overline{x}'\,\middle|\, q}$,
torej je $\set{\overline{x}\,\middle|\, p} \leq \set{\overline{x}'\,\middle|\, q}$.
Za model $\mathcal{U}$ velja tudi, da je \emph{konzervativen}, kar pomeni,
da za vse sekvente $p \implies q$
$$\text{če} \ \mathcal{U} \models p \implies q \ \text{,potem} \ T \vdash_{\overline{x}} p \implies q$$
kar sledi iz zgornje argumentacije in leme o klasifikaciji monomorfizmov v $\mathcal{R}(T)$.
Če to povzamemo 
\begin{izrek}
  Kanonična interpretacija $\mathcal{U}$ v regularni kategoriji $\mathcal{R}(T)$ je konzervativen model teorije $T$. Pravila sklepanja v regularni logiki so polna glede na interpretacije v majhnih regularnih kategorijah.
\end{izrek}
Sedaj lahko podamo funktorje, ki nastopajo v ekvivalenci 
$$\Mod(T, \cat{C}) \simeq \cat{RegCat}(\mathcal{R}, \cat{C}),$$
naravni v $\cat{C}$. Funktor 
$$\mathfrak{M}_{\cat{C}} : \cat{RegCat}(\mathcal{R}, \cat{C}) \to \Mod(T, \cat{C})$$
je funktor $\mathfrak{M}_{\mathcal{U}, \cat{C}}$, kot smo ga definiral v definiciji ?? in pošlje funktor $F : \mathcal{R}(T) \to \cat{C}$ v model $F_T(\mathcal{U})$ v $\cat{C}$ ter naravno transformacijo $\alpha : F \to F$ v družino
$$F_T(\alpha) = \set{\alpha_{\caninterp{X}} : F(\caninterp{X}) \to G(\caninterp{X})}_{X \in \underline{\mathrm{sort}}_{\Sigma}}.$$
V drugo smer, funktor 
$$\mathfrak{F}_{\cat{C}} : \Mod(T, \cat{C}) \to \cat{RegCat}(\mathcal{R}(T), \cat{C})$$
pošlje model $M$ teorije $T$ v kategoriji $\cat{C}$ v funktor
\begin{align*}
  \mathfrak{F}_{\cat{C}} : \mathcal{R}(T) &\to \cat{C}\\
  \set{\overline{x}\,\middle|\, p} &\mapsto \set{\overline{x}\,\middle|\, p}^{(M)} \\
  \set{\gamma} : \set{\overline{x}\,\middle|\, p} \to \set{\overline{y}\,\middle|\, q} &\mapsto \text{`enolični morfizem} \ f : \set{\overline{x}\,\middle|\, p}^{(M)} \to \set{\overline{y}\,\middle|\, q}^{(M)} \\ 
  &\qquad \text{da je} \ \graph(f) = \set{(\overline{x}, \overline{y}) \,\middle|\, \gamma}^{(M)} \text{'}.
\end{align*}
Morfizem $f$ obstaja po lemi ??. Veljavnost pravil sklepanja in dejstvo, da model lahko definiramo z interno logiko $\cat{C}$ pomeni, da je $\mathfrak{F}_{\cat{C}}(M)$ regularen funktor.
Morfizem med modeloma $h : M \to N$ porodi družino morfizmov 
$$h_{\set{\overline{x}\,\middle|\, p}} : \set{\overline{x}\,\middle|\, p}^{(M)} \to \set{\overline{x}\,\middle|\, p}^{(N)},$$
ki je naraven, ker če imamo morfizem $\set{\gamma} : \set{\overline{x}\,\middle|\, p} \to \set{\overline{y}\,\middle|\, q}$ potem, ker oba kvadrata v naslednjem diagramu komutirata, to pomeni, da komutira tudi zunanji, ki predstavlja ravno diagram naravne transformacije:
\begin{equation*}
  \begin{tikzcd}[column sep=3cm]
    \set{\overline{x}\,\middle|\, p}^{(M)} \ar[d, two heads] \ar[r, "h_{\set{\overline{x}\,\middle|\, p}}"] & \set{\overline{x}\,\middle|\, p}^{(N)} \ar[d, two heads] \\
    \set{\overline{y}\,\middle|\, \exists \overline{x} \gamma(\overline{x}, \overline{y})}^{(M)}  \ar[d, hook] \ar[r, "h_{\set{\overline{y}\,\middle|\, \exists \overline{x} \gamma(\overline{x}, \overline{y})}}"] & \set{\overline{y}\,\middle|\, \exists \overline{x} \gamma(\overline{x}, \overline{y})}^{(N)} \ar[d, hook] \\
    \set{\overline{y}\,\middle|\, q}^{(M)} \ar[r, "h_{\set{\overline{y}\,\middle|\, q}}"] & \set{\overline{y}\,\middle|\, q}^{(N)}
  \end{tikzcd}
\end{equation*}
Ta funktor je naraven v $\cat{C}$: Če je $F : \cat{D} \to \cat{C}$ regularen funktor, potem diagram
\begin{equation}
  \begin{tikzcd}
    \Mod(T, \cat{D}) \ar[d, "F_T"'] \ar[r, "\mathfrak{F}_{\cat{D}}"] & \cat{RegCat}(\mathcal{R}(T), \cat{D}) \ar[d, "F \circ (\_)"] \\
    \Mod(T, \cat{C}) \ar[r, "\mathfrak{F}_{\cat{C}}"'] & \cat{RegCat}(\mathcal{R}(T), \cat{C})
  \end{tikzcd}
\end{equation}
komutira.
\begin{izrek}
  Funktorja $\mathfrak{M}_{\cat{C}}$ in $\mathfrak{F}_{\cat{C}}$ inducirata ekvivalenco kategorij
  $$\Mod(T, \cat{C}) \simeq \cat{RegCat}(\mathcal{R}(T), \cat{C}),$$
  ki je naravna v $\cat{C}$. Do ekvivalence natančno, vsaka majhna regularna kategorija $\cat{C}$ nastane na tak način, kot `klasifikacijska kategorija' regularne teorije, kajti $\cat{C} \simeq \mathcal{R}(T_{\cat{C}})$.
\end{izrek}
\begin{dokaz}
  Preverimo, da je kompozitum v obe smeri izomorfen identiteti. Drugi del sledi iz leme ??.
\end{dokaz}
\end{document}